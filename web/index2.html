<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lista de Usuários</title>

    <!-- Carregue o Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-firestore.js"></script>

    <style media="screen">
      body { background: #ECEFF1; color: rgba(0,0,0,0.87); font-family: Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
      #users-list { max-width: 360px; margin: 100px auto 16px; padding: 32px 24px; border-radius: 3px; background: white; }
      #users-list h2 { color: #ffa100; font-weight: bold; font-size: 16px; margin: 0 0 8px; }
      #users-list ul { list-style-type: none; padding: 0; }
      #users-list li { margin-bottom: 8px; }
      .lote { margin-left: 20px; }
    </style>
  </head>
  <body>
    <!-- Adicione o botão aqui -->
    <button onclick="consultarQrCode()">Consultar QR Code</button>

    <div id="users-list">
      <h2>Usuários</h2>
      <ul id="users">
        <!-- Aqui serão inseridos os nomes dos usuários e seus lotes -->
      </ul>
    </div>

    <script>
      // Configure o Firebase
      var firebaseConfig = {
        apiKey: "AIzaSyCDll66xmGhwbYBFRRBxj8lvQIFrwXydqw",
        authDomain: "forest-traceability.firebaseapp.com",
        projectId: "forest-traceability",
        storageBucket: "forest-traceability.appspot.com",
        messagingSenderId: "883889030916",
        appId: "1:883889030916:web:1a9ce44e058b39d7fa7251",
        measurementId: "G-3Q760CMJBM"
      };
      firebase.initializeApp(firebaseConfig);

      // Inicialize o Firestore
      var db = firebase.firestore();

      // Referência para a coleção 'users'
      var usersRef = db.collection('users');

      // Query para buscar todos os documentos na coleção 'users'
      usersRef.get().then((querySnapshot) => {
        // Elemento ul onde serão exibidos os nomes dos usuários e seus lotes
        var usersList = document.getElementById('users');

        // Itera sobre os documentos de usuários
        querySnapshot.forEach((userDoc) => {
          // Obtém o nome do usuário do documento
          var userName = userDoc.data().name; // Substitua 'name' pelo nome do campo no seu documento

          // Cria um item de lista para o usuário
          var userLi = document.createElement('li');
          userLi.textContent = "Usuário: " + userName; // Exibe o nome do usuário em vez do ID
          usersList.appendChild(userLi);

          // Verifica se o usuário possui uma coleção 'lotes'
          var lotesRef = userDoc.ref.collection('lotes');
          lotesRef.get().then((lotesQuerySnapshot) => {
            // Itera sobre os documentos de lotes do usuário
            lotesQuerySnapshot.forEach((loteDoc) => {
              // Adiciona o nome do lote ao item de lista do usuário
              var loteLi = document.createElement('li');
              loteLi.textContent = "Nome do Lote: " + loteDoc.data().nomeLote;
              loteLi.classList.add('lote');
              userLi.appendChild(loteLi);
            });
          }).catch((error) => {
            console.error("Erro ao obter lotes do usuário " + userDoc.id + ": ", error);
          });
        });
      }).catch((error) => {
        console.error("Erro ao obter usuários: ", error);
      });

      // Função para redirecionar para a página qrcode.html
      function consultarQrCode() {
        window.location.href = "qrcode.html";
      }
    </script>
  </body>
</html>